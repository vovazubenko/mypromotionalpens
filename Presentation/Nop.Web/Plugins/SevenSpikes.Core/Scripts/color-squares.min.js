/*
* Copyright 2016 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

!function(a,b,c){function f(){var a=[];return b(d).each(function(){var c=b(this).attr("data-productid");if(c&&c>0){var d={productId:c,productElement:b(this)};a.push(d)}}),a}function g(a,d){var f=c.getAttrValFromDom(e,"data-productbox-container-selector");if(f){var g=d.productElement.find(f);if(!(g.find("ul.attribute-squares").length>0)&&g&&d.productId&&d.productId>0){var h=d.productId,i=b(a).filter("ul[data-productId='"+h+"']");if(i&&i.length>0){b(g).append(i),b(g).addClass("active");var j=b(".product-item").has("[data-productid="+h+"]");j.find(" .second-product-image").remove(),j.find(".product-box-attribute-square.preselected").click()}}}}function h(a,b){if(b&&b.length>0)for(var c=0;c<b.length;c++)g(a,b[c])}function i(){return c.getAttrValFromDom(e,"data-retrieve-color-squares-url")}var d,e="#color-squares-info";a.getColorSquares=function(){var a=f();if(a&&0!==a.length){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.hasOwnProperty("productId")&&c.push(e.productId)}var g={productIds:c},j=i();b.ajax({type:"POST",data:b.toJSON(g),contentType:"application/json; charset=utf-8",url:j}).done(function(c){c&&(h(c,a),b.event.trigger({type:"colorSquaresLoadingCompleteEvent"}))})}},b(document).ready(function(){d=c.getAttrValFromDom(e,"data-productbox-selector"),d&&a.getColorSquares()}),b(document).on("click",".product-box-attribute-square",function(){var a=b(this),d=a.closest("li");if(!d.hasClass("selected-value")){var e=c.getAttrValFromDom("#color-squares-info","data-product-attribute-change-url"),f=a.closest(".product-item").data("productid");if(f&&f>0){var g={};g[a.attr("name")]=a.attr("value"),b.ajax({cache:!1,url:e+"?productId="+f+"&validateAttributeConditions=true&loadpicture=true",data:g,type:"POST",success:function(b){if(b.price){var d=c.getAttrValFromDom("#color-squares-info","data-productbox-price-selector"),e=a.closest(".product-item").find(d);e.length>0&&e.text(b.price)}if(b.pictureDefaultSizeUrl){var f=a.closest(".product-item").find(".picture img");f.attr("src",b.pictureDefaultSizeUrl)}}})}d.addClass("selected-value"),d.siblings(".selected-value").removeClass("selected-value")}}),b(document).on("nopAjaxFiltersFiltrationCompleteEvent newProductsAddedToPageEvent",a.getColorSquares)}(window.colorSquares=window.colorSquares||{},jQuery,sevenSpikes);